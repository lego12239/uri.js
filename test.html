<html>
<head>
  <title>uri test</title>
  <meta charset="utf-8"/>
  <script type="text/javascript" src="uri/uri.js">
  </script>
  <script type="text/javascript" src="uri/http.js">
  </script>
  <script type="text/javascript" src="uri/mailto.js">
  </script>
  <script type="text/javascript">
    var span_ok, span_fail, res_cntr_el;
    var scnt = 0;
    var tests_total = 0;
    var tests_run = 0;
    var tests_ok = 0;
    var tests = [
    	{title: "Parsing: scheme, authority, path, query, fragment",
    	 fun: uri_parse.bind(this,
    	   "unknown://www.domain.ru/path/to/page?a=b&c=d#fragMenT"),
    	 check_fun: check_parse.bind(this, {
    		_: {
	    	    scheme: "unknown",
	    	    authority: {
	    	    	host: "www.domain.ru"},
	    	    path: "/path/to/page",
	    	 	query: "a=b&c=d",
	    	 	fragment: "fragMenT"}})},
    	{title: "Parsing: scheme, authority, path, query, fragment(with #)",
    	 fun: uri_parse.bind(this,
    	   "unknown://www.domain.ru/path/to/page?a=b&c=d#frag#MenT"),
    	 check_fun: check_parse.bind(this, {
    	 	_: {
	    	    scheme: "unknown",
	    	    authority: {
	    	    	host: "www.domain.ru"},
	    	    path: "/path/to/page",
	    	 	query: "a=b&c=d",
	    	 	fragment: "frag#MenT"}})},
    	{title: "Parsing: scheme, authority, path, query, empty fragment",
    	 fun: uri_parse.bind(this,
    	   "unknown://www.domain.ru/path/to/page?a=b&c=d#"),
    	 check_fun: check_parse.bind(this, {
    	 	_: {
	    	    scheme: "unknown",
	    	    authority: {
	    	    	host: "www.domain.ru"},
	    	    path: "/path/to/page",
	    	 	query: "a=b&c=d",
	    	 	fragment: ""}})},
    	{title: "Parsing: scheme, authority, path, query",
    	 fun: uri_parse.bind(this, 
    	   "unknown://www.domain.ru/path/to/page?a=b&c=d"),
    	 check_fun: check_parse.bind(this, {
    	 	_: {
	    	    scheme: "unknown",
	    	    authority: {
	    	    	host: "www.domain.ru"},
	    	    path: "/path/to/page",
	    	 	query: "a=b&c=d"}})},
    	{title: "Parsing: scheme, authority, path, query(with ?), fragment",
    	 fun: uri_parse.bind(this,
    	   "unknown://www.domain.ru/path/to/page?a=b?&c=?d#fragMenT"),
    	 check_fun: check_parse.bind(this, {
    	 	_: {
	    	    scheme: "unknown",
	    	    authority: {
	    	    	host: "www.domain.ru"},
	    	    path: "/path/to/page",
	    	 	query: "a=b?&c=?d",
	    	 	fragment: "fragMenT"}})},
    	{title: "Parsing: scheme, authority, path, query(with ?), fragment(with #)",
    	 fun: uri_parse.bind(this,
    	   "unknown://www.domain.ru/path/to/page?a=b?&c=?d#frag#MenT"),
    	 check_fun: check_parse.bind(this, {
    	 	_: {
	    	    scheme: "unknown",
	    	    authority: {
	    	    	host: "www.domain.ru"},
	    	    path: "/path/to/page",
	    	 	query: "a=b?&c=?d",
	    	 	fragment: "frag#MenT"}})},
    	{title: "Parsing: scheme, authority, path, query(with ?), empty fragment",
    	 fun: uri_parse.bind(this,
    	   "unknown://www.domain.ru/path/to/page?a=b?&c=?d#"),
    	 check_fun: check_parse.bind(this, {
    	 	_: {
	    	    scheme: "unknown",
	    	    authority: {
	    	    	host: "www.domain.ru"},
	    	    path: "/path/to/page",
	    	 	query: "a=b?&c=?d",
	    	 	fragment: ""}})},
    	{title: "Parsing: scheme, authority, path, query(with ?)",
    	 fun: uri_parse.bind(this, 
    	   "unknown://www.domain.ru/path/to/page?a=b?&c=?d"),
    	 check_fun: check_parse.bind(this, {
    	 	_: {
	    	    scheme: "unknown",
	    	    authority: {
	    	    	host: "www.domain.ru"},
	    	    path: "/path/to/page",
	    	 	query: "a=b?&c=?d"}})},
    	{title: "Parsing: scheme, authority, path, fragment",
    	 fun: uri_parse.bind(this,
    	   "unknown://www.domain.ru/path/to/page#fragMenT"),
    	 check_fun: check_parse.bind(this, {
    	 	_: {
	    	    scheme: "unknown",
	    	    authority: {
	    	    	host: "www.domain.ru"},
	    	    path: "/path/to/page",
	    	 	fragment: "fragMenT"}})},
    	{title: "Parsing: scheme, authority, path",
    	 fun: uri_parse.bind(this,
    	   "unknown://www.domain.ru/path/to/page"),
    	 check_fun: check_parse.bind(this, {
    	 	_: {
	    	    scheme: "unknown",
	    	    authority: {
	    	    	host: "www.domain.ru"},
	    	    path: "/path/to/page"}})},
    	{title: "Parsing: scheme, authority, query, fragment",
    	 fun: uri_parse.bind(this,
    	   "unknown://www.domain.ru?a=b?&c=?d#frag#MenT"),
    	 check_fun: check_parse.bind(this, {
    	 	_: {
	    	    scheme: "unknown",
	    	    authority: {
	    	    	host: "www.domain.ru"},
	    	 	query: "a=b?&c=?d",
	    	 	fragment: "frag#MenT"}})},
    	{title: "Parsing: scheme, authority, query",
    	 fun: uri_parse.bind(this,
    	   "unknown://www.domain.ru?a=b?&c=?d"),
    	 check_fun: check_parse.bind(this, {
    	 	_: {
	    	    scheme: "unknown",
	    	    authority: {
	    	    	host: "www.domain.ru"},
	    	 	query: "a=b?&c=?d"}})},
    	{title: "Parsing: scheme, authority, fragment",
    	 fun: uri_parse.bind(this,
    	   "unknown://www.domain.ru#frag#MenT"),
    	 check_fun: check_parse.bind(this, {
    	 	_: {
	    	    scheme: "unknown",
	    	    authority: {
	    	    	host: "www.domain.ru"},
	    	 	fragment: "frag#MenT"}})},
    	{title: "Parsing: scheme, authority",
    	 fun: uri_parse.bind(this,
    	   "unknown://www.domain.ru"),
    	 check_fun: check_parse.bind(this, {
    	 	_: {
	    	    scheme: "unknown",
	    	    authority: {
	    	    	host: "www.domain.ru"}}})},
    	{title: "Parsing: scheme, path, query, fragment",
    	 fun: uri_parse.bind(this,
    	   "unknown:/path/to/page?a=b?&c=?d#frag#MenT"),
    	 check_fun: check_parse.bind(this, {
    	 	_: {
	    	    scheme: "unknown",
	    	    path: "/path/to/page",
	    	 	query: "a=b?&c=?d",
	    	 	fragment: "frag#MenT"}})},
    	{title: "Parsing: scheme, path, query",
    	 fun: uri_parse.bind(this,
    	   "unknown:/path/to/page?a=b?&c=?d"),
    	 check_fun: check_parse.bind(this, {
    	 	_: {
	    	    scheme: "unknown",
	    	    path: "/path/to/page",
	    	 	query: "a=b?&c=?d"}})},
    	{title: "Parsing: scheme, path, fragment",
    	 fun: uri_parse.bind(this,
    	   "unknown:/path/to/page#frag#MenT"),
    	 check_fun: check_parse.bind(this, {
    	 	_: {
	    	    scheme: "unknown",
	    	    path: "/path/to/page",
	    	 	fragment: "frag#MenT"}})},
    	{title: "Parsing: scheme, path",
    	 fun: uri_parse.bind(this,
    	   "unknown:/path/to/page"),
    	 check_fun: check_parse.bind(this, {
    	 	_: {
	    	    scheme: "unknown",
	    	    path: "/path/to/page"}})},
    	{title: "Parsing: scheme, query, fragment",
    	 fun: uri_parse.bind(this,
    	   "unknown:?a=b?&c=?d#frag#MenT"),
    	 check_fun: check_parse.bind(this, {
    	 	_: {
	    	    scheme: "unknown",
	    	 	query: "a=b?&c=?d",
	    	 	fragment: "frag#MenT"}})},
    	{title: "Parsing: scheme, query",
    	 fun: uri_parse.bind(this,
    	   "unknown:?a=b?&c=?d"),
    	 check_fun: check_parse.bind(this, {
    	 	_: {
	    	    scheme: "unknown",
	    	 	query: "a=b?&c=?d"}})},
    	{title: "Parsing: scheme, fragment",
    	 fun: uri_parse.bind(this,
    	   "unknown:#frag#MenT"),
    	 check_fun: check_parse.bind(this, {
    	 	_: {
	    	    scheme: "unknown",
	    	 	fragment: "frag#MenT"}})},
    	{title: "Parsing: scheme",
    	 fun: uri_parse.bind(this,
    	   "unknown:"),
    	 check_fun: check_parse.bind(this, {
    	 	_: {
	    	    scheme: "unknown"}})},
      	{title: "Parsing: authority, path, query, fragment",
    	 fun: uri_parse.bind(this,
    	   "//www.domain.ru/path/to/page?a=b&c=d#fragMenT"),
    	 check_fun: check_parse.bind(this, {
    		_: {
	    	    authority: {
	    	    	host: "www.domain.ru"},
	    	    path: "/path/to/page",
	    	 	query: "a=b&c=d",
	    	 	fragment: "fragMenT"}})},
    	{title: "Parsing: authority, path, query",
    	 fun: uri_parse.bind(this, 
    	   "//www.domain.ru/path/to/page?a=b&c=d"),
    	 check_fun: check_parse.bind(this, {
    	 	_: {
	    	    authority: {
	    	    	host: "www.domain.ru"},
	    	    path: "/path/to/page",
	    	 	query: "a=b&c=d"}})},
     	{title: "Parsing: authority, path, fragment",
    	 fun: uri_parse.bind(this,
    	   "//www.domain.ru/path/to/page#fragMenT"),
    	 check_fun: check_parse.bind(this, {
    	 	_: {
	    	    authority: {
	    	    	host: "www.domain.ru"},
	    	    path: "/path/to/page",
	    	 	fragment: "fragMenT"}})},
    	{title: "Parsing: authority, path",
    	 fun: uri_parse.bind(this,
    	   "//www.domain.ru/path/to/page"),
    	 check_fun: check_parse.bind(this, {
    	 	_: {
	    	    authority: {
	    	    	host: "www.domain.ru"},
	    	    path: "/path/to/page"}})},
    	{title: "Parsing: authority, query, fragment",
    	 fun: uri_parse.bind(this,
    	   "//www.domain.ru?a=b?&c=?d#frag#MenT"),
    	 check_fun: check_parse.bind(this, {
    	 	_: {
	    	    authority: {
	    	    	host: "www.domain.ru"},
	    	 	query: "a=b?&c=?d",
	    	 	fragment: "frag#MenT"}})},
    	{title: "Parsing: authority, query",
    	 fun: uri_parse.bind(this,
    	   "//www.domain.ru?a=b?&c=?d"),
    	 check_fun: check_parse.bind(this, {
    	 	_: {
	    	    authority: {
	    	    	host: "www.domain.ru"},
	    	 	query: "a=b?&c=?d"}})},
    	{title: "Parsing: authority, fragment",
    	 fun: uri_parse.bind(this,
    	   "//www.domain.ru#frag#MenT"),
    	 check_fun: check_parse.bind(this, {
    	 	_: {
	    	    authority: {
	    	    	host: "www.domain.ru"},
	    	 	fragment: "frag#MenT"}})},
    	{title: "Parsing: authority",
    	 fun: uri_parse.bind(this,
    	   "//www.domain.ru"),
    	 check_fun: check_parse.bind(this, {
    	 	_: {
	    	    authority: {
	    	    	host: "www.domain.ru"}}})},
    	{title: "Parsing: path, query, fragment",
    	 fun: uri_parse.bind(this,
    	   "/path/to/page?a=b?&c=?d#frag#MenT"),
    	 check_fun: check_parse.bind(this, {
    	 	_: {
	    	    path: "/path/to/page",
	    	 	query: "a=b?&c=?d",
	    	 	fragment: "frag#MenT"}})},
    	{title: "Parsing: path, query",
    	 fun: uri_parse.bind(this,
    	   "/path/to/page?a=b?&c=?d"),
    	 check_fun: check_parse.bind(this, {
    	 	_: {
	    	    path: "/path/to/page",
	    	 	query: "a=b?&c=?d"}})},
    	{title: "Parsing: path, fragment",
    	 fun: uri_parse.bind(this,
    	   "/path/to/page#frag#MenT"),
    	 check_fun: check_parse.bind(this, {
    	 	_: {
	    	    path: "/path/to/page",
	    	 	fragment: "frag#MenT"}})},
    	{title: "Parsing: path",
    	 fun: uri_parse.bind(this,
    	   "/path/to/page"),
    	 check_fun: check_parse.bind(this, {
    	 	_: {
	    	    path: "/path/to/page"}})},
    	{title: "Parsing: query, fragment",
    	 fun: uri_parse.bind(this,
    	   "?a=b?&c=?d#frag#MenT"),
    	 check_fun: check_parse.bind(this, {
    	 	_: {
	    	 	query: "a=b?&c=?d",
	    	 	fragment: "frag#MenT"}})},
    	{title: "Parsing: query",
    	 fun: uri_parse.bind(this,
    	   "?a=b?&c=?d"),
    	 check_fun: check_parse.bind(this, {
    	 	_: {
	    	 	query: "a=b?&c=?d"}})},
    	{title: "Parsing: fragment",
    	 fun: uri_parse.bind(this,
    	   "#frag#MenT"),
    	 check_fun: check_parse.bind(this, {
    	 	_: {
	    	 	fragment: "frag#MenT"}})},
    	{title: "Parsing: spaces ",
    	 fun: uri_parse.bind(this, " 	"),
    	 check_fun: check_parse.bind(this, null)},
    	{title: "Parsing: empty ",
    	 fun: uri_parse.bind(this, ""),
    	 check_fun: check_parse.bind(this, null)},
    	{title: "Parsing: null",
    	 fun: uri_parse.bind(this, null),
    	 check_fun: check_parse.bind(this, null)},
    	{title: "Parsing: authority: userinfo, host, port",
    	 fun: uri_parse.bind(this,
    	   "unknown://use:r@www.domain.ru:8888/path/to/page?a=b&c=d#fragMenT"),
    	 check_fun: check_parse.bind(this, {
    		_: {
	    	    scheme: "unknown",
	    	    authority: {
	    	    	userinfo: "use:r",
	    	    	host: "www.domain.ru",
	    	    	port: 8888},
	    	    path: "/path/to/page",
	    	 	query: "a=b&c=d",
	    	 	fragment: "fragMenT"}})},
    	{title: "Parsing: authority: userinfo, host, empty port",
    	 fun: uri_parse.bind(this,
    	   "unknown://use:r@www.domain.ru:/path/to/page?a=b&c=d#fragMenT"),
    	 check_fun: check_parse.bind(this, {
    		_: {
	    	    scheme: "unknown",
	    	    authority: {
	    	    	userinfo: "use:r",
	    	    	host: "www.domain.ru",
	    	    	port: ""},
	    	    path: "/path/to/page",
	    	 	query: "a=b&c=d",
	    	 	fragment: "fragMenT"}})},
    	{title: "Parsing: authority: userinfo, host",
    	 fun: uri_parse.bind(this,
    	   "unknown://use:r@www.domain.ru/path/to/page?a=b&c=d#fragMenT"),
    	 check_fun: check_parse.bind(this, {
    		_: {
	    	    scheme: "unknown",
	    	    authority: {
	    	    	userinfo: "use:r",
	    	    	host: "www.domain.ru"},
	    	    path: "/path/to/page",
	    	 	query: "a=b&c=d",
	    	 	fragment: "fragMenT"}})},
    	{title: "Parsing: authority: userinfo empty, host",
    	 fun: uri_parse.bind(this,
    	   "unknown://@www.domain.ru/path/to/page?a=b&c=d#fragMenT"),
    	 check_fun: check_parse.bind(this, {
    		_: {
	    	    scheme: "unknown",
	    	    authority: {
	    	    	userinfo: "",
	    	    	host: "www.domain.ru"},
	    	    path: "/path/to/page",
	    	 	query: "a=b&c=d",
	    	 	fragment: "fragMenT"}})},
    	{title: "Parsing: authority: userinfo empty, host, port",
    	 fun: uri_parse.bind(this,
    	   "unknown://@www.domain.ru:8888/path/to/page?a=b&c=d#fragMenT"),
    	 check_fun: check_parse.bind(this, {
    		_: {
	    	    scheme: "unknown",
	    	    authority: {
	    	    	userinfo: "",
	    	    	host: "www.domain.ru",
	    	    	port: 8888},
	    	    path: "/path/to/page",
	    	 	query: "a=b&c=d",
	    	 	fragment: "fragMenT"}})},
    	{title: "Parsing: authority: host, port",
    	 fun: uri_parse.bind(this,
    	   "unknown://www.domain.ru:8888/path/to/page?a=b&c=d#fragMenT"),
    	 check_fun: check_parse.bind(this, {
    		_: {
	    	    scheme: "unknown",
	    	    authority: {
	    	    	host: "www.domain.ru",
	    	    	port: 8888},
	    	    path: "/path/to/page",
	    	 	query: "a=b&c=d",
	    	 	fragment: "fragMenT"}})},
    	{title: "Parsing: authority: host, empty port",
    	 fun: uri_parse.bind(this,
    	   "unknown://www.domain.ru:/path/to/page?a=b&c=d#fragMenT"),
    	 check_fun: check_parse.bind(this, {
    		_: {
	    	    scheme: "unknown",
	    	    authority: {
	    	    	host: "www.domain.ru",
	    	    	port: ""},
	    	    path: "/path/to/page",
	    	 	query: "a=b&c=d",
	    	 	fragment: "fragMenT"}})},
    	{title: "Parsing: authority: ipv6 addr as a host",
    	 fun: uri_parse.bind(this,
    	   "unknown://[fe80::7657:bd53:daac:e55b]/path/to/page?a=b&c=d#fragMenT"),
    	 check_fun: check_parse.bind(this, {
    		_: {
	    	    scheme: "unknown",
	    	    authority: {
	    	    	host: "fe80::7657:bd53:daac:e55b"},
	    	    path: "/path/to/page",
	    	 	query: "a=b&c=d",
	    	 	fragment: "fragMenT"}})},
    	{title: "Parsing: authority: ipv6 addr as a host, port",
    	 fun: uri_parse.bind(this,
    	   "unknown://[fe80::7657:bd53:daac:e55b]:8888/path/to/page?a=b&c=d#fragMenT"),
    	 check_fun: check_parse.bind(this, {
    		_: {
	    	    scheme: "unknown",
	    	    authority: {
	    	    	host: "fe80::7657:bd53:daac:e55b",
	    	    	port: 8888},
	    	    path: "/path/to/page",
	    	 	query: "a=b&c=d",
	    	 	fragment: "fragMenT"}})},
    	{title: "Parsing: lowercasing of scheme",
    	 fun: uri_parse.bind(this,
    	   "unKnoWn://www.domain.ru/path/to/page?a=b&c=d#fragMenT"),
    	 check_fun: check_parse.bind(this, {
    		_: {
	    	    scheme: "unknown",
	    	    authority: {
	    	    	host: "www.domain.ru"},
	    	    path: "/path/to/page",
	    	 	query: "a=b&c=d",
	    	 	fragment: "fragMenT"}})},
    	{title: "Parsing: lowercasing of host",
    	 fun: uri_parse.bind(this,
    	   "unknown://wwW.DoMAin.RU/path/to/page?a=b&c=d#fragMenT"),
    	 check_fun: check_parse.bind(this, {
    		_: {
	    	    scheme: "unknown",
	    	    authority: {
	    	    	host: "www.domain.ru"},
	    	    path: "/path/to/page",
	    	 	query: "a=b&c=d",
	    	 	fragment: "fragMenT"}})},
    	{title: "Parsing: pct-encoded in userinfo",
    	 fun: uri_parse.bind(this,
    	   "unknown://use%3Ar@www.domain.ru/path/to/page?a=b&c=d#fragMenT"),
    	 check_fun: check_parse.bind(this, {
    		_: {
	    	    scheme: "unknown",
	    	    authority: {
	    	    	userinfo: "use:r",
	    	    	host: "www.domain.ru"},
	    	    path: "/path/to/page",
	    	 	query: "a=b&c=d",
	    	 	fragment: "fragMenT"}})},
    	{title: "Parsing: pct-encoded in host",
    	 fun: uri_parse.bind(this,
    	   "unknown://www.d%6f%6Da%69n.ru/path/to/page?a=b&c=d#fragMenT"),
    	 check_fun: check_parse.bind(this, {
    		_: {
	    	    scheme: "unknown",
	    	    authority: {
	    	    	host: "www.domain.ru"},
	    	    path: "/path/to/page",
	    	 	query: "a=b&c=d",
	    	 	fragment: "fragMenT"}})},
    	{title: "Parsing: pct-encoded in host & lowercasing",
    	 fun: uri_parse.bind(this,
    	   "unknown://www.d%4f%6Da%69n.ru/path/to/page?a=b&c=d#fragMenT"),
    	 check_fun: check_parse.bind(this, {
    		_: {
	    	    scheme: "unknown",
	    	    authority: {
	    	    	host: "www.domain.ru"},
	    	    path: "/path/to/page",
	    	 	query: "a=b&c=d",
	    	 	fragment: "fragMenT"}})},
    	{title: "Composing: scheme, authority, path, query, fragment",
    	 fun: uri_compose.bind(this, {
    		_: {
	    	    scheme: "unknown",
	    	    authority: {
	    	    	host: "www.domain.ru"},
	    	    path: "/path/to/page",
	    	 	query: "a=b&c=d",
	    	 	fragment: "fragMenT"}}),
	     check_fun: check_compose.bind(this,
    	   "unknown://www.domain.ru/path/to/page?a=b&c=d#fragMenT")},
    	{title: "Composing: scheme, authority, path, query, empty fragment",
    	 fun: uri_compose.bind(this, {
    		_: {
	    	    scheme: "unknown",
	    	    authority: {
	    	    	host: "www.domain.ru"},
	    	    path: "/path/to/page",
	    	 	query: "a=b&c=d",
	    	 	fragment: ""}}),
	     check_fun: check_compose.bind(this,
    	   "unknown://www.domain.ru/path/to/page?a=b&c=d#")},
    	{title: "Composing: scheme, authority, path, query",
    	 fun: uri_compose.bind(this, {
    		_: {
	    	    scheme: "unknown",
	    	    authority: {
	    	    	host: "www.domain.ru"},
	    	    path: "/path/to/page",
	    	 	query: "a=b&c=d",
	    	 	fragment: null}}),
	     check_fun: check_compose.bind(this,
    	   "unknown://www.domain.ru/path/to/page?a=b&c=d")},
    	{title: "Composing: scheme, authority, path, empty query, fragment",
    	 fun: uri_compose.bind(this, {
    		_: {
	    	    scheme: "unknown",
	    	    authority: {
	    	    	host: "www.domain.ru"},
	    	    path: "/path/to/page",
	    	 	query: "",
	    	 	fragment: "fragMenT"}}),
	     check_fun: check_compose.bind(this,
    	   "unknown://www.domain.ru/path/to/page?#fragMenT")},
    	{title: "Composing: scheme, authority, path, fragment",
    	 fun: uri_compose.bind(this, {
    		_: {
	    	    scheme: "unknown",
	    	    authority: {
	    	    	host: "www.domain.ru"},
	    	    path: "/path/to/page",
	    	 	query: null,
	    	 	fragment: "fragMenT"}}),
	     check_fun: check_compose.bind(this,
    	   "unknown://www.domain.ru/path/to/page#fragMenT")},
    	{title: "Composing: scheme, authority, path, empty query, empty fragment",
    	 fun: uri_compose.bind(this, {
    		_: {
	    	    scheme: "unknown",
	    	    authority: {
	    	    	host: "www.domain.ru"},
	    	    path: "/path/to/page",
	    	 	query: "",
	    	 	fragment: ""}}),
	     check_fun: check_compose.bind(this,
    	   "unknown://www.domain.ru/path/to/page?#")},
    	{title: "Composing: scheme, authority, path",
    	 fun: uri_compose.bind(this, {
    		_: {
	    	    scheme: "unknown",
	    	    authority: {
	    	    	host: "www.domain.ru"},
	    	    path: "/path/to/page",
	    	 	query: null,
	    	 	fragment: null}}),
	     check_fun: check_compose.bind(this,
    	   "unknown://www.domain.ru/path/to/page")},
    	{title: "Composing: scheme, authority, empty path, query, fragment",
    	 fun: uri_compose.bind(this, {
    		_: {
	    	    scheme: "unknown",
	    	    authority: {
	    	    	host: "www.domain.ru"},
	    	    path: "",
	    	 	query: "a=b&c=d",
	    	 	fragment: "fragMenT"}}),
	     check_fun: check_compose.bind(this,
    	   "unknown://www.domain.ru?a=b&c=d#fragMenT")},
    	{title: "Composing: scheme, authority, query, fragment",
    	 fun: uri_compose.bind(this, {
    		_: {
	    	    scheme: "unknown",
	    	    authority: {
	    	    	host: "www.domain.ru"},
	    	    path: null,
	    	 	query: "a=b&c=d",
	    	 	fragment: "fragMenT"}}),
	     check_fun: check_compose.bind(this,
    	   "unknown://www.domain.ru?a=b&c=d#fragMenT")},
    	{title: "Composing: scheme, authority, query",
    	 fun: uri_compose.bind(this, {
    		_: {
	    	    scheme: "unknown",
	    	    authority: {
	    	    	host: "www.domain.ru"},
	    	    path: null,
	    	 	query: "a=b&c=d",
	    	 	fragment: null}}),
	     check_fun: check_compose.bind(this,
    	   "unknown://www.domain.ru?a=b&c=d")},
    	{title: "Composing: scheme, authority, fragment",
    	 fun: uri_compose.bind(this, {
    		_: {
	    	    scheme: "unknown",
	    	    authority: {
	    	    	host: "www.domain.ru"},
	    	    path: null,
	    	 	query: null,
	    	 	fragment: "fragMenT"}}),
	     check_fun: check_compose.bind(this,
    	   "unknown://www.domain.ru#fragMenT")},
    	{title: "Composing: scheme, authority",
    	 fun: uri_compose.bind(this, {
    		_: {
	    	    scheme: "unknown",
	    	    authority: {
	    	    	host: "www.domain.ru"},
	    	    path: null,
	    	 	query: null,
	    	 	fragment: null}}),
	     check_fun: check_compose.bind(this,
    	   "unknown://www.domain.ru")},
    	{title: "Composing: scheme, empty authority, path, query, fragment",
    	 fun: uri_compose.bind(this, {
    		_: {
	    	    scheme: "unknown",
	    	    authority: {},
	    	    path: "/path/to/page",
	    	 	query: "a=b&c=d",
	    	 	fragment: "fragMenT"}}),
	     check_fun: check_compose.bind(this,
    	   "unknown:///path/to/page?a=b&c=d#fragMenT")},
    	{title: "Composing: scheme, path, query, fragment",
    	 fun: uri_compose.bind(this, {
    		_: {
	    	    scheme: "unknown",
	    	    path: "/path/to/page",
	    	 	query: "a=b&c=d",
	    	 	fragment: "fragMenT"}}),
	     check_fun: check_compose.bind(this,
    	   "unknown:/path/to/page?a=b&c=d#fragMenT")},
    	{title: "Composing: scheme, path, query",
    	 fun: uri_compose.bind(this, {
    		_: {
	    	    scheme: "unknown",
	    	    path: "/path/to/page",
	    	 	query: "a=b&c=d",
	    	 	fragment: null}}),
	     check_fun: check_compose.bind(this,
    	   "unknown:/path/to/page?a=b&c=d")},
    	{title: "Composing: scheme, path, fragment",
    	 fun: uri_compose.bind(this, {
    		_: {
	    	    scheme: "unknown",
	    	    path: "/path/to/page",
	    	 	query: null,
	    	 	fragment: "fragMent"}}),
	     check_fun: check_compose.bind(this,
    	   "unknown:/path/to/page#fragMent")},
    	{title: "Composing: scheme, path",
    	 fun: uri_compose.bind(this, {
    		_: {
	    	    scheme: "unknown",
	    	    path: "/path/to/page",
	    	 	query: null,
	    	 	fragment: null}}),
	     check_fun: check_compose.bind(this,
    	   "unknown:/path/to/page")},
    	{title: "Composing: scheme, query, fragment",
    	 fun: uri_compose.bind(this, {
    		_: {
	    	    scheme: "unknown",
	    	    path: null,
	    	 	query: "a=b&c=d",
	    	 	fragment: "fragMenT"}}),
	     check_fun: check_compose.bind(this,
    	   "unknown:?a=b&c=d#fragMenT")},
    	{title: "Composing: scheme, query",
    	 fun: uri_compose.bind(this, {
    		_: {
	    	    scheme: "unknown",
	    	    path: null,
	    	 	query: "a=b&c=d",
	    	 	fragment: null}}),
	     check_fun: check_compose.bind(this,
    	   "unknown:?a=b&c=d")},
    	{title: "Composing: scheme, fragment",
    	 fun: uri_compose.bind(this, {
    		_: {
	    	    scheme: "unknown",
	    	    path: null,
	    	 	query: null,
	    	 	fragment: "fragMent"}}),
	     check_fun: check_compose.bind(this,
    	   "unknown:#fragMent")},
    	{title: "Composing: scheme",
    	 fun: uri_compose.bind(this, {
    		_: {
	    	    scheme: "unknown",
	    	    path: null,
	    	 	query: null,
	    	 	fragment: null}}),
	     check_fun: check_compose.bind(this,
    	   "unknown:")},
    	{title: "Composing: empty scheme, authority, path, query, fragment",
    	 fun: uri_compose.bind(this, {
    		_: {
	    	    scheme: "",
	    	    authority: {
	    	    	host: "www.domain.ru"},
	    	    path: "/path/to/page",
	    	 	query: "a=b&c=d",
	    	 	fragment: "fragMenT"}}),
	     check_fun: check_compose.bind(this,
    	   "://www.domain.ru/path/to/page?a=b&c=d#fragMenT")},
    	{title: "Composing: authority, path, query, fragment",
    	 fun: uri_compose.bind(this, {
    		_: {
	    	    scheme: null,
	    	    authority: {
	    	    	host: "www.domain.ru"},
	    	    path: "/path/to/page",
	    	 	query: "a=b&c=d",
	    	 	fragment: "fragMenT"}}),
	     check_fun: check_compose.bind(this,
    	   "//www.domain.ru/path/to/page?a=b&c=d#fragMenT")},
    	{title: "Composing: authority, path, query",
    	 fun: uri_compose.bind(this, {
    		_: {
	    	    scheme: null,
	    	    authority: {
	    	    	host: "www.domain.ru"},
	    	    path: "/path/to/page",
	    	 	query: "a=b&c=d",
	    	 	fragment: null}}),
	     check_fun: check_compose.bind(this,
    	   "//www.domain.ru/path/to/page?a=b&c=d")},
    	{title: "Composing: authority, path, fragment",
    	 fun: uri_compose.bind(this, {
    		_: {
	    	    scheme: null,
	    	    authority: {
	    	    	host: "www.domain.ru"},
	    	    path: "/path/to/page",
	    	 	query: null,
	    	 	fragment: "fragMenT"}}),
	     check_fun: check_compose.bind(this,
    	   "//www.domain.ru/path/to/page#fragMenT")},
    	{title: "Composing: authority, path",
    	 fun: uri_compose.bind(this, {
    		_: {
	    	    scheme: null,
	    	    authority: {
	    	    	host: "www.domain.ru"},
	    	    path: "/path/to/page",
	    	 	query: null,
	    	 	fragment: null}}),
	     check_fun: check_compose.bind(this,
    	   "//www.domain.ru/path/to/page")},
    	{title: "Composing: authority, query, fragment",
    	 fun: uri_compose.bind(this, {
    		_: {
	    	    scheme: null,
	    	    authority: {
	    	    	host: "www.domain.ru"},
	    	    path: null,
	    	 	query: "a=b&c=d",
	    	 	fragment: "fragMenT"}}),
	     check_fun: check_compose.bind(this,
    	   "//www.domain.ru?a=b&c=d#fragMenT")},
    	{title: "Composing: authority, query",
    	 fun: uri_compose.bind(this, {
    		_: {
	    	    scheme: null,
	    	    authority: {
	    	    	host: "www.domain.ru"},
	    	    path: null,
	    	 	query: "a=b&c=d",
	    	 	fragment: null}}),
	     check_fun: check_compose.bind(this,
    	   "//www.domain.ru?a=b&c=d")},
    	{title: "Composing: authority, fragment",
    	 fun: uri_compose.bind(this, {
    		_: {
	    	    scheme: null,
	    	    authority: {
	    	    	host: "www.domain.ru"},
	    	    path: null,
	    	 	query: null,
	    	 	fragment: "fragMenT"}}),
	     check_fun: check_compose.bind(this,
    	   "//www.domain.ru#fragMenT")},
    	{title: "Composing: authority",
    	 fun: uri_compose.bind(this, {
    		_: {
	    	    scheme: null,
	    	    authority: {
	    	    	host: "www.domain.ru"},
	    	    path: null,
	    	 	query: null,
	    	 	fragment: null}}),
	     check_fun: check_compose.bind(this,
    	   "//www.domain.ru")},
    	{title: "Composing: path, query, fragment",
    	 fun: uri_compose.bind(this, {
    		_: {
	    	    scheme: null,
	    	    path: "/path/to/page",
	    	 	query: "a=b&c=d",
	    	 	fragment: "fragMenT"}}),
	     check_fun: check_compose.bind(this,
    	   "/path/to/page?a=b&c=d#fragMenT")},
    	{title: "Composing: path, query",
    	 fun: uri_compose.bind(this, {
    		_: {
	    	    scheme: null,
	    	    path: "/path/to/page",
	    	 	query: "a=b&c=d",
	    	 	fragment: null}}),
	     check_fun: check_compose.bind(this,
    	   "/path/to/page?a=b&c=d")},
    	{title: "Composing: path, fragment",
    	 fun: uri_compose.bind(this, {
    		_: {
	    	    scheme: null,
	    	    path: "/path/to/page",
	    	 	query: null,
	    	 	fragment: "fragMent"}}),
	     check_fun: check_compose.bind(this,
    	   "/path/to/page#fragMent")},
    	{title: "Composing: path",
    	 fun: uri_compose.bind(this, {
    		_: {
	    	    scheme: null,
	    	    path: "/path/to/page",
	    	 	query: null,
	    	 	fragment: null}}),
	     check_fun: check_compose.bind(this,
    	   "/path/to/page")},
    	{title: "Composing: query, fragment",
    	 fun: uri_compose.bind(this, {
    		_: {
	    	    scheme: null,
	    	    path: null,
	    	 	query: "a=b&c=d",
	    	 	fragment: "fragMenT"}}),
	     check_fun: check_compose.bind(this,
    	   "?a=b&c=d#fragMenT")},
    	{title: "Composing: query",
    	 fun: uri_compose.bind(this, {
    		_: {
	    	    scheme: null,
	    	    path: null,
	    	 	query: "a=b&c=d",
	    	 	fragment: null}}),
	     check_fun: check_compose.bind(this,
    	   "?a=b&c=d")},
    	{title: "Composing: fragment",
    	 fun: uri_compose.bind(this, {
    		_: {
	    	    scheme: null,
	    	    path: null,
	    	 	query: null,
	    	 	fragment: "fragMent"}}),
	     check_fun: check_compose.bind(this,
    	   "#fragMent")},
    	{title: "Composing: empty scheme",
    	 fun: uri_compose.bind(this, {
    		_: {
	    	    scheme: "",
	    	    path: null,
	    	 	query: null,
	    	 	fragment: null}}),
	     check_fun: check_compose.bind(this,
    	   ":")},
    	{title: "Composing: null scheme",
    	 fun: uri_compose.bind(this, {
    		_: {
	    	    scheme: null,
	    	    path: null,
	    	 	query: null,
	    	 	fragment: null}}),
	     check_fun: check_compose.bind(this, "")},
    	{title: "Composing: null scheme",
    	 fun: uri_compose.bind(this, null),
	     check_fun: check_compose.bind(this, null)},
    	{title: "Composing: lowercasing of scheme",
    	 fun: uri_compose.bind(this, {
    		_: {
	    	    scheme: "unkNown",
	    	    authority: {
	    	    	host: "www.domain.ru"},
	    	    path: "/path/to/page",
	    	 	query: "a=b&c=d",
	    	 	fragment: "fragMenT"}}),
	     check_fun: check_compose.bind(this,
    	   "unknown://www.domain.ru/path/to/page?a=b&c=d#fragMenT")},
    	{title: "Composing: lowercasing of host",
    	 fun: uri_compose.bind(this, {
    		_: {
	    	    scheme: "unknown",
	    	    authority: {
	    	    	host: "www.dOMaiN.ru"},
	    	    path: "/path/to/page",
	    	 	query: "a=b&c=d",
	    	 	fragment: "fragMenT"}}),
	     check_fun: check_compose.bind(this,
    	   "unknown://www.domain.ru/path/to/page?a=b&c=d#fragMenT")},
    	{title: "Composing: pct-encoded in userinfo",
    	 fun: uri_compose.bind(this, {
    		_: {
	    	    scheme: "unknown",
	    	    authority: {
	    	    	userinfo: "use@",
	    	    	host: "www.domain.ru"},
	    	    path: "/path/to/page",
	    	 	query: "a=b&c=d",
	    	 	fragment: "fragMenT"}}),
	     check_fun: check_compose.bind(this,
    	   "unknown://use%40@www.domain.ru/path/to/page?a=b&c=d#fragMenT")},
    	{title: "Composing: pct-encoded in host",
    	 fun: uri_compose.bind(this, {
    		_: {
	    	    scheme: "unknown",
	    	    authority: {
	    	    	host: "www.doma/in.ru"},
	    	    path: "/path/to/page"}}),
	     check_fun: check_compose_lower.bind(this,
    	   "unknown://www.doma%2fin.ru/path/to/page")},
    	{title: "Composing: pct-encoded in host & lowercasing",
    	 fun: uri_compose.bind(this, {
    		_: {
	    	    scheme: "unknown",
	    	    authority: {
	    	    	host: "www.doMAinÐ¯.Ru"},
	    	    path: "/path/to/page"}}),
	     check_fun: check_compose_lower.bind(this,
    	   "unknown://www.domain%d1%8f.ru/path/to/page")},
    	{title: "http parsing: scheme, authority, path, query, fragment",
    	 fun: uri_parse.bind(this,
    	   "http://www.domain.ru/Path/to/pAge?a=b&c=d#fragMenT"),
    	 check_fun: check_parse.bind(this, {
    	 	scheme: "http",
    	 	authority: {
    	 		host: "www.domain.ru",
    	 		port: 80},
	    	path: "/Path/to/pAge",
	    	query: {
	    		a: "b",
	    		c: "d"},
	    	fragment: "fragMenT",
    		_: {
	    	    scheme: "http",
	    	    authority: {
	    	    	host: "www.domain.ru"},
	    	    path: "/Path/to/pAge",
	    	 	query: "a=b&c=d",
	    	 	fragment: "fragMenT"}})},
    	{title: "http parsing: scheme, authority, pct-encoded path, query, fragment",
    	 fun: uri_parse.bind(this,
    	   "http://www.domain.ru/Pat%68/t%4f/pAge?a=b&c=d#fragMenT"),
    	 check_fun: check_parse.bind(this, {
    	 	scheme: "http",
    	 	authority: {
    	 		host: "www.domain.ru",
    	 		port: 80},
	    	path: "/Path/tO/pAge",
	    	query: {
	    		a: "b",
	    		c: "d"},
	    	fragment: "fragMenT",
    		_: {
	    	    scheme: "http",
	    	    authority: {
	    	    	host: "www.domain.ru"},
	    	    path: "/Pat%68/t%4f/pAge",
	    	 	query: "a=b&c=d",
	    	 	fragment: "fragMenT"}})},
    	{title: "http parsing: scheme, authority, path, pct-encoded query, fragment",
    	 fun: uri_parse.bind(this,
    	   "http://www.domain.ru/Path/tO/pAge?a=%3db%26&%63=%26d%23#fragMenT"),
    	 check_fun: check_parse.bind(this, {
    	 	scheme: "http",
    	 	authority: {
    	 		host: "www.domain.ru",
    	 		port: 80},
	    	path: "/Path/tO/pAge",
	    	query: {
	    		a: "=b&",
	    		c: "&d#"},
	    	fragment: "fragMenT",
    		_: {
	    	    scheme: "http",
	    	    authority: {
	    	    	host: "www.domain.ru"},
	    	    path: "/Path/tO/pAge",
	    	 	query: "a=%3db%26&%63=%26d%23",
	    	 	fragment: "fragMenT"}})},
    	{title: "http parsing: scheme, authority, path, query, pct-encoded fragment",
    	 fun: uri_parse.bind(this,
    	   "http://www.domain.ru/Path/tO/pAge?a=b&c=d#frag%4d%4denT"),
    	 check_fun: check_parse.bind(this, {
    	 	scheme: "http",
    	 	authority: {
    	 		host: "www.domain.ru",
    	 		port: 80},
	    	path: "/Path/tO/pAge",
	    	query: {
	    		a: "b",
	    		c: "d"},
	    	fragment: "fragMMenT",
    		_: {
	    	    scheme: "http",
	    	    authority: {
	    	    	host: "www.domain.ru"},
	    	    path: "/Path/tO/pAge",
	    	 	query: "a=b&c=d",
	    	 	fragment: "frag%4d%4denT"}})},
    	{title: "http composing: scheme, authority, path, query, fragment",
    	 fun: uri_compose.bind(this, {
    	 	scheme: "http",
    	 	authority: {
    	 		host: "www.domain.ru",
    	 		port: 80},
	    	path: "/Path/to/pAge",
	    	query: {
	    		a: "b",
	    		c: "d"},
	    	fragment: "fragMenT"}),
    	 check_fun: check_compose.bind(this,
    	   "http://www.domain.ru/Path/to/pAge?a=b&c=d#fragMenT")},
    	{title: "http composing: scheme, authority, pct-encoded path, query, fragment",
    	 fun: uri_compose.bind(this, {
    	 	scheme: "http",
    	 	authority: {
    	 		host: "www.domain.ru",
    	 		port: 80},
	    	path: "/Path/t+o/pAge"}),
    	 check_fun: check_compose_lower.bind(this,
    	   "http://www.domain.ru/path/t%2bo/page")},
    	{title: "http composing: scheme, authority, path, pct-encoded query, fragment",
    	 fun: uri_compose.bind(this, {
    	 	scheme: "http",
    	 	authority: {
    	 		host: "www.domain.ru",
    	 		port: 80},
	    	path: "/Path/to/pAge",
	    	query: {
	    		a: "=b&",
	    		c: "&d#"}}),
    	 check_fun: check_compose_lower.bind(this,
    	   "http://www.domain.ru/path/to/page?a=%3db%26&c=%26d%23")},
    	{title: "http composing: scheme, authority, path, query, pct-encoded fragment",
    	 fun: uri_compose.bind(this, {
    	 	scheme: "http",
    	 	authority: {
    	 		host: "www.domain.ru",
    	 		port: 80},
	    	path: "/Path/to/pAge",
	    	query: {
	    		a: "b",
	    		c: "d"},
	    	fragment: "frag#MenT"}),
    	 check_fun: check_compose_lower.bind(this,
    	   "http://www.domain.ru/path/to/page?a=b&c=d#frag%23ment")},
    	{title: "https parsing: scheme, authority, path, query, fragment",
    	 fun: uri_parse.bind(this,
    	   "https://www.domain.ru/Path/to/pAge?a=b&c=d#fragMenT"),
    	 check_fun: check_parse.bind(this, {
    	 	scheme: "https",
    	 	authority: {
    	 		host: "www.domain.ru",
    	 		port: 443},
	    	path: "/Path/to/pAge",
	    	query: {
	    		a: "b",
	    		c: "d"},
	    	fragment: "fragMenT",
    		_: {
	    	    scheme: "https",
	    	    authority: {
	    	    	host: "www.domain.ru"},
	    	    path: "/Path/to/pAge",
	    	 	query: "a=b&c=d",
	    	 	fragment: "fragMenT"}})},
    	{title: "https parsing: scheme, authority, pct-encoded path, query, fragment",
    	 fun: uri_parse.bind(this,
    	   "https://www.domain.ru/Pat%68/t%4f/pAge?a=b&c=d#fragMenT"),
    	 check_fun: check_parse.bind(this, {
    	 	scheme: "https",
    	 	authority: {
    	 		host: "www.domain.ru",
    	 		port: 443},
	    	path: "/Path/tO/pAge",
	    	query: {
	    		a: "b",
	    		c: "d"},
	    	fragment: "fragMenT",
    		_: {
	    	    scheme: "https",
	    	    authority: {
	    	    	host: "www.domain.ru"},
	    	    path: "/Pat%68/t%4f/pAge",
	    	 	query: "a=b&c=d",
	    	 	fragment: "fragMenT"}})},
    	{title: "https parsing: scheme, authority, path, pct-encoded query, fragment",
    	 fun: uri_parse.bind(this,
    	   "https://www.domain.ru/Path/tO/pAge?a=%3db%26&%63=%26d%23#fragMenT"),
    	 check_fun: check_parse.bind(this, {
    	 	scheme: "https",
    	 	authority: {
    	 		host: "www.domain.ru",
    	 		port: 443},
	    	path: "/Path/tO/pAge",
	    	query: {
	    		a: "=b&",
	    		c: "&d#"},
	    	fragment: "fragMenT",
    		_: {
	    	    scheme: "https",
	    	    authority: {
	    	    	host: "www.domain.ru"},
	    	    path: "/Path/tO/pAge",
	    	 	query: "a=%3db%26&%63=%26d%23",
	    	 	fragment: "fragMenT"}})},
    	{title: "https parsing: scheme, authority, path, query, pct-encoded fragment",
    	 fun: uri_parse.bind(this,
    	   "https://www.domain.ru/Path/tO/pAge?a=b&c=d#frag%4d%4denT"),
    	 check_fun: check_parse.bind(this, {
    	 	scheme: "https",
    	 	authority: {
    	 		host: "www.domain.ru",
    	 		port: 443},
	    	path: "/Path/tO/pAge",
	    	query: {
	    		a: "b",
	    		c: "d"},
	    	fragment: "fragMMenT",
    		_: {
	    	    scheme: "https",
	    	    authority: {
	    	    	host: "www.domain.ru"},
	    	    path: "/Path/tO/pAge",
	    	 	query: "a=b&c=d",
	    	 	fragment: "frag%4d%4denT"}})},
    	{title: "https composing: scheme, authority, path, query, fragment",
    	 fun: uri_compose.bind(this, {
    	 	scheme: "https",
    	 	authority: {
    	 		host: "www.domain.ru",
    	 		port: 443},
	    	path: "/Path/to/pAge",
	    	query: {
	    		a: "b",
	    		c: "d"},
	    	fragment: "fragMenT"}),
    	 check_fun: check_compose.bind(this,
    	   "https://www.domain.ru/Path/to/pAge?a=b&c=d#fragMenT")},
    	{title: "https composing: scheme, authority, pct-encoded path, query, fragment",
    	 fun: uri_compose.bind(this, {
    	 	scheme: "https",
    	 	authority: {
    	 		host: "www.domain.ru",
    	 		port: 443},
	    	path: "/Path/t+o/pAge"}),
    	 check_fun: check_compose_lower.bind(this,
    	   "https://www.domain.ru/path/t%2bo/page")},
    	{title: "https composing: scheme, authority, path, pct-encoded query, fragment",
    	 fun: uri_compose.bind(this, {
    	 	scheme: "https",
    	 	authority: {
    	 		host: "www.domain.ru",
    	 		port: 443},
	    	path: "/Path/to/pAge",
	    	query: {
	    		a: "=b&",
	    		c: "&d#"}}),
    	 check_fun: check_compose_lower.bind(this,
    	   "https://www.domain.ru/path/to/page?a=%3db%26&c=%26d%23")},
    	{title: "https composing: scheme, authority, path, query, pct-encoded fragment",
    	 fun: uri_compose.bind(this, {
    	 	scheme: "https",
    	 	authority: {
    	 		host: "www.domain.ru",
    	 		port: 443},
	    	path: "/Path/to/pAge",
	    	query: {
	    		a: "b",
	    		c: "d"},
	    	fragment: "frag#MenT"}),
    	 check_fun: check_compose_lower.bind(this,
    	   "https://www.domain.ru/path/to/page?a=b&c=d#frag%23ment")},
    	{title: "mailto parsing: empty",
    	 fun: uri_parse.bind(this,
    	   "mailto:"),
    	 check_fun: check_parse.bind(this, {
    	 	scheme: "mailto",
    	 	_: {
    	 		scheme: "mailto"}})},
    	{title: "mailto parsing: addr",
    	 fun: uri_parse.bind(this,
    	   "mailto:name@domain.ru"),
    	 check_fun: check_parse.bind(this, {
    	 	scheme: "mailto",
    	 	to: "name@domain.ru",
    	 	_: {
    	 		scheme: "mailto",
    	 		path: "name@domain.ru"}})},
    	{title: "mailto parsing: addr, fields",
    	 fun: uri_parse.bind(this,
    	   "mailto:name@domain.ru?subject=test&body=some%20body"),
    	 check_fun: check_parse.bind(this, {
    	 	scheme: "mailto",
    	 	to: "name@domain.ru",
    	 	subject: "test",
    	 	body: "some%20body",
    	 	_: {
    	 		scheme: "mailto",
    	 		path: "name@domain.ru",
    	 		query: "subject=test&body=some%20body"}})},
    	{title: "mailto parsing: addr, fields with scheme field",
    	 fun: uri_parse.bind(this,
    	   "mailto:name@domain.ru?subject=test&body=some%20body&scheme=qq"),
    	 check_fun: check_parse.bind(this, {
    	 	scheme: "mailto",
    	 	to: "name@domain.ru",
    	 	subject: "test",
    	 	body: "some%20body",
    	 	e: {
    	 		scheme: "qq"},
    	 	_: {
    	 		scheme: "mailto",
    	 		path: "name@domain.ru",
    	 		query: "subject=test&body=some%20body&scheme=qq"}})},
    	{title: "mailto parsing: addr, fields with scheme and _ field",
    	 fun: uri_parse.bind(this,
    	   "mailto:name@domain.ru?subject=test&body=some%20body&scheme=qq&_=ff"),
    	 check_fun: check_parse.bind(this, {
    	 	scheme: "mailto",
    	 	to: "name@domain.ru",
    	 	subject: "test",
    	 	body: "some%20body",
    	 	e: {
    	 		scheme: "qq",
    	 		_: "ff"},
    	 	_: {
    	 		scheme: "mailto",
    	 		path: "name@domain.ru",
    	 		query: "subject=test&body=some%20body&scheme=qq&_=ff"}})},
    	{title: "mailto parsing: addr, fields with scheme and e field",
    	 fun: uri_parse.bind(this,
    	   "mailto:name@domain.ru?subject=test&body=some%20body&scheme=qq&e=ff"),
    	 check_fun: check_parse.bind(this, {
    	 	scheme: "mailto",
    	 	to: "name@domain.ru",
    	 	subject: "test",
    	 	body: "some%20body",
    	 	e: {
    	 		scheme: "qq",
    	 		e: "ff"},
    	 	_: {
    	 		scheme: "mailto",
    	 		path: "name@domain.ru",
    	 		query: "subject=test&body=some%20body&scheme=qq&e=ff"}})},
    	{title: "mailto parsing: addr, fields with to",
    	 fun: uri_parse.bind(this,
    	   "mailto:name@domain.ru?to=another@d.com&subject=test&body=some%20body"),
    	 check_fun: check_parse.bind(this, {
    	 	scheme: "mailto",
    	 	to: "another@d.com",
    	 	subject: "test",
    	 	body: "some%20body",
    	 	_: {
    	 		scheme: "mailto",
    	 		path: "name@domain.ru",
    	 		query: "to=another@d.com&subject=test&body=some%20body"}})},
    	{title: "mailto parsing: fields with to",
    	 fun: uri_parse.bind(this,
    	   "mailto:?to=another@d.com&subject=test&body=some%20body"),
    	 check_fun: check_parse.bind(this, {
    	 	scheme: "mailto",
    	 	to: "another@d.com",
    	 	subject: "test",
    	 	body: "some%20body",
    	 	_: {
    	 		scheme: "mailto",
    	 		query: "to=another@d.com&subject=test&body=some%20body"}})},
    	{title: "mailto parsing: fields with to and uppercase",
    	 fun: uri_parse.bind(this,
    	   "mailto:?to=another@d.com&subJect=test&boDy=some%20body"),
    	 check_fun: check_parse.bind(this, {
    	 	scheme: "mailto",
    	 	to: "another@d.com",
    	 	subject: "test",
    	 	body: "some%20body",
    	 	_: {
    	 		scheme: "mailto",
    	 		query: "to=another@d.com&subJect=test&boDy=some%20body"}})},
    	{title: "mailto composing: empty",
    	 fun: uri_compose.bind(this, {
    	 	scheme: "mailto"}),
    	 check_fun: check_compose.bind(this, "mailto:")},
    	{title: "mailto composing: to",
    	 fun: uri_compose.bind(this, {
    	 	scheme: "mailto",
    	 	to: "name@domain.ru"}),
    	 check_fun: check_compose.bind(this, "mailto:name@domain.ru")},
    	{title: "mailto composing: to and other fields",
    	 fun: uri_compose.bind(this, {
    	 	scheme: "mailto",
    	 	to: "name@domain.ru",
    	 	subject: "test",
    	 	body: "some%20body"}),
    	 check_fun: check_compose.bind(this, "mailto:name@domain.ru?subject=test&body=some%20body")},
    	{title: "mailto composing: to and other fields with scheme field",
    	 fun: uri_compose.bind(this, {
    	 	scheme: "mailto",
    	 	to: "name@domain.ru",
    	 	subject: "test",
    	 	body: "some%20body",
    	 	e: {
    	 		scheme: "qq"}}),
    	 check_fun: check_compose.bind(this, "mailto:name@domain.ru?subject=test&body=some%20body&scheme=qq")},
    	{title: "mailto composing: to and other fields with scheme and _ fields",
    	 fun: uri_compose.bind(this, {
    	 	scheme: "mailto",
    	 	to: "name@domain.ru",
    	 	subject: "test",
    	 	body: "some%20body",
    	 	e: {
    	 		scheme: "qq",
    	 		_: "ff"}}),
    	 check_fun: check_compose.bind(this, "mailto:name@domain.ru?subject=test&body=some%20body&scheme=qq&_=ff")},
    	{title: "mailto composing: to and other fields with scheme and e fields",
    	 fun: uri_compose.bind(this, {
    	 	scheme: "mailto",
    	 	to: "name@domain.ru",
    	 	subject: "test",
    	 	body: "some%20body",
    	 	e: {
    	 		scheme: "qq",
    	 		e: "ff"}}),
    	 check_fun: check_compose.bind(this, "mailto:name@domain.ru?subject=test&body=some%20body&scheme=qq&e=ff")},
    	{title: "mailto composing: to and other fields uppercase",
    	 fun: uri_compose.bind(this, {
    	 	scheme: "mailto",
    	 	tO: "name@domain.ru",
    	 	subjECt: "test",
    	 	boDy: "some%20body"}),
    	 check_fun: check_compose.bind(this, "mailto:name@domain.ru?subject=test&body=some%20body")},
    	{title: "mailto composing: to and other fields with scheme and e fields uppercase",
    	 fun: uri_compose.bind(this, {
    	 	scheme: "mailto",
    	 	to: "name@domain.ru",
    	 	subject: "test",
    	 	body: "some%20body",
    	 	e: {
    	 		schEMe: "qq",
    	 		E: "ff"}}),
    	 check_fun: check_compose.bind(this, "mailto:name@domain.ru?subject=test&body=some%20body&scheme=qq&e=ff")},
    	{load: ["uri/mailto_a.js"]},
    	{title: "[mailto_a] mailto parsing: empty",
    	 fun: uri_parse.bind(this,
    	   "mailto:"),
    	 check_fun: check_parse.bind(this, {
    	 	scheme: "mailto",
    	 	_: {
    	 		scheme: "mailto"}})},
    	{title: "[mailto_a] mailto parsing: addr",
    	 fun: uri_parse.bind(this,
    	   "mailto:name@domain.ru"),
    	 check_fun: check_parse.bind(this, {
    	 	scheme: "mailto",
    	 	to: ["name@domain.ru"],
    	 	_: {
    	 		scheme: "mailto",
    	 		path: "name@domain.ru"}})},
    	{title: "[mailto_a] mailto parsing: addr, pct-encoded fields",
    	 fun: uri_parse.bind(this,
    	   "mailto:name@domain.ru?subject=test&body=some%20body"),
    	 check_fun: check_parse.bind(this, {
    	 	scheme: "mailto",
    	 	to: ["name@domain.ru"],
    	 	subject: "test",
    	 	body: "some body",
    	 	_: {
    	 		scheme: "mailto",
    	 		path: "name@domain.ru",
    	 		query: "subject=test&body=some%20body"}})},
    	{title: "[mailto_a] mailto parsing: addr >1, fields",
    	 fun: uri_parse.bind(this,
    	   "mailto:name@domain.ru,user@site.com?subject=test&body=some%20body"),
    	 check_fun: check_parse.bind(this, {
    	 	scheme: "mailto",
    	 	to: ["name@domain.ru", "user@site.com"],
    	 	subject: "test",
    	 	body: "some body",
    	 	_: {
    	 		scheme: "mailto",
    	 		path: "name@domain.ru,user@site.com",
    	 		query: "subject=test&body=some%20body"}})},
    	{title: "[mailto_a] mailto parsing: addr >1, fields cc > 1",
    	 fun: uri_parse.bind(this,
    	   "mailto:name@domain.ru,user@site.com?cc=m1@some.biz,m2@thing.su&subject=test&body=some%20body"),
    	 check_fun: check_parse.bind(this, {
    	 	scheme: "mailto",
    	 	to: ["name@domain.ru", "user@site.com"],
    	 	cc: ["m1@some.biz", "m2@thing.su"],
    	 	subject: "test",
    	 	body: "some body",
    	 	_: {
    	 		scheme: "mailto",
    	 		path: "name@domain.ru,user@site.com",
    	 		query: "cc=m1@some.biz,m2@thing.su&subject=test&body=some%20body"}})},
    	{title: "[mailto_a] mailto composing: empty",
    	 fun: uri_compose.bind(this, {
    	 	scheme: "mailto"}),
    	 check_fun: check_compose.bind(this, "mailto:")},
    	{title: "[mailto_a] mailto composing: addr > 1",
    	 fun: uri_compose.bind(this, {
    	 	scheme: "mailto",
    	 	to: ["name@domain.ru", "user@site.com"]}),
    	 check_fun: check_compose.bind(this, "mailto:name@domain.ru,user@site.com")},
    	{title: "[mailto_a] mailto composing: addr > 1, pct-encoded fields",
    	 fun: uri_compose.bind(this, {
    	 	scheme: "mailto",
    	 	to: ["name@domain.ru", "user@site.com"],
    	 	subject: "test",
    	 	body: "some body"}),
    	 check_fun: check_compose.bind(this, "mailto:name@domain.ru,user@site.com?subject=test&body=some%20body")},
    	{title: "[mailto_a] mailto composing: addr > 1, pct-encoded fields, cc > 1",
    	 fun: uri_compose.bind(this, {
    	 	scheme: "mailto",
    	 	to: ["name@domain.ru", "user@site.com"],
    	 	cc: ["m1@some.biz", "m2@thing.su"],
    	 	subject: "test",
    	 	body: "some body"}),
    	 check_fun: check_compose.bind(this, "mailto:name@domain.ru,user@site.com?cc=m1@some.biz,m2@thing.su&subject=test&body=some%20body")}];

    function report_ok(test)
    {
        var el, span;


        el = document.createElement("div");
        span = document.createElement("span");
        span.innerHTML = "test '" + test.idx + "' (" + test.title + "): ";
        el.appendChild(span);
        el.appendChild(span_ok.cloneNode(true));
        res_cntr_el.appendChild(el);
        
        tests_ok++;
        
        return 1;
    }

    function report_fail(test)
    {
        var el, span;


        el = document.createElement("div");
        span = document.createElement("span");
        span.innerHTML = "test '" + test.idx + "' (" + test.title + "): ";
        el.appendChild(span);
        el.appendChild(span_fail.cloneNode(true));
        res_cntr_el.appendChild(el);
        
        return 0;
    }
    
    function check_parse(must, _uri) {
    	if ((must == null) && (must == _uri))
    		return 1;
    	if (!_check_parse(must, _uri))
    		return 0;
    	return _check_parse(_uri, must);
    }
	function _check_parse(must, got)
	{
		var p, i;
	
		for(p in must)
			if (Object.prototype.toString.call(must[p]) == "[object Object]") {
				if (!_check_parse(got[p], must[p]))
					return 0;
			} else if (Array.isArray(must[p])) {
				if (!Array.isArray(got[p]))
					return 0;
				if (got[p].length != must[p].length)
					return 0;
				for(i = 0; i < must[p].length; i++)
					if (got[p][i] != must[p][i])
						return 0;
			} else if (got[p] != must[p]) 
				return 0;
		return 1;
	}
    function check_compose(must, _uri) {
    	if (must == _uri)
    		return 1;
    	return 0;
    }
    function check_compose_lower(must, _uri) {
    	if (must == _uri.toLowerCase())
    		return 1;
    	return 0;
    }
	
    function do_tests(off)
    {
		var i;
		var res;


		span_ok = document.getElementById("results_ok");
		span_fail = document.getElementById("results_fail");
		res_cntr_el = document.getElementById("results");

        // set counter initial value
        document.getElementById("counter").innerHTML = "0/" + tests.length;

        for(i = off == null ? 0 : off; i < tests.length; i++) {
        	if (tests[i].load != null) {
        		load_scripts(tests[i].load, i + 1);
        		return;
        	}
        	tests[i].idx = i;
            try {
            	res = tests[i].fun();
            } catch (ex) {
            	console.log(ex);
                report_fail(tests[i]);
                continue;
            }
            tests_run++;
            console.log("test" + i + ": " + JSON.stringify(tests[i]));
            console.log("test" + i + " res: " + JSON.stringify(res));

            if (tests[i].check_fun(res))
            	report_ok(tests[i]);
            else
            	report_fail(tests[i]);
            	
            // set counter
            document.getElementById("counter").innerHTML = "all: " + tests_total + " run: " + tests_run + " ok: " + tests_ok;
        }
        
	}
    function load_scripts(scripts, idx)
    {
    	var i;
    	var e;
        
        scnt = scripts.length;
        for(i = 0; i < scripts.length; i++) {
	    	e = document.createElement("script");
	    	e.type = "text/javascript";
	    	e.src = scripts[i];
	    	e.onload = load_scripts_done.bind(this, idx);
	    	document.head.appendChild(e);
	    }
    }
    function load_scripts_done(idx)
    {
    	scnt--;
    	if (scnt)
    		return;
    	do_tests(idx);
    }
    function init()
    {
    	var i;
    	
    	tests_total = tests.length;
    	for(i = 0; i < tests.length; i++)
    		if (tests[i].load != null)
    			tests_total--;
    	do_tests();
    }
  </script>
</head>
<body onload="init()">
  <div style="margin: 1em">
    tests: <span id="counter">all: 0</span>
  </div>

  <div style="display: none">
    <span id="results_fail" style="color: red; font-weight: bold">fail</span>
    <span id="results_ok" style="color: green; font-weight: bold">ok</span>
  </div>
  
  <div id="results">
  </div>
</body>
</html>
